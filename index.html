<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Big Games API Hub</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        body { background-color: #fffbcc; color: #333; }
        header { text-align: center; background: linear-gradient(45deg, #ff6b6b, #ffa502); padding: 1rem; color: white; border-radius: 10px; }
        .grid { margin-top: 20px; }
        .card { padding: 1rem; border-radius: 10px; background-color: white; box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1); }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <h1>Big Games API Hub</h1>
        <p>Explore collections, clans, and stats from the Big Games universe!</p>
    </header>

<main class="container">
    <h2>Game Collections</h2>
    <ul id="collections-container">Loading...</ul>  <!-- ✅ Data will appear here -->
</main>

<script>
async function fetchCategories() {
    const categoriesUrl = "/.netlify/functions/apiFetch?url=https://ps99.biggamesapi.io/api/collections";
    console.log("Fetching categories from:", categoriesUrl);
    const container = document.getElementById("collections-container");

    try {
        const response = await fetch(categoriesUrl);
        if (!response.ok) throw new Error(`HTTP Error ${response.status}`);
        const categoriesData = await response.json();
        console.log("API Response (Categories):", categoriesData);

        if (categoriesData && categoriesData.data && Array.isArray(categoriesData.data)) {
            container.innerHTML = ""; // Clear loading text

            // Fetch detailed data for each category
            for (const category of categoriesData.data) {
                await fetchCategoryDetails(category, container);
            }
        } else {
            container.innerHTML = "<p class='error'>Unexpected API response format.</p>";
        }
    } catch (error) {
        console.error("API Fetch Error:", error);
        container.innerHTML = `<p class='error'>Failed to load data.</p>`;
    }
}

// ✅ Fetch detailed data for each category
async function fetchCategoryDetails(category, container) {
    const categoryUrl = `/.netlify/functions/apiFetch?url=https://ps99.biggamesapi.io/api/collection/${encodeURIComponent(category)}`;
    console.log("Fetching details for:", categoryUrl);

    try {
        const response = await fetch(categoryUrl);
        if (!response.ok) throw new Error(`HTTP Error ${response.status}`);
        const categoryData = await response.json();
        console.log(`API Response (${category}):`, categoryData);

        // ✅ Display category and its details
        const categoryElement = document.createElement("div");
        categoryElement.innerHTML = `
            <h3>${category}</h3>
            <pre>${JSON.stringify(categoryData, null, 2)}</pre>
        `;
        container.appendChild(categoryElement);
    } catch (error) {
        console.error(`Error fetching ${category}:`, error);
    }
}

// ✅ Load data on page load
document.addEventListener("DOMContentLoaded", fetchCategories);
</script>

</body>
</html>
