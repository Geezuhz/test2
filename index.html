<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Big Games API Hub</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        body { background-color: #fffbcc; color: #333; }
        header { text-align: center; background: linear-gradient(45deg, #ff6b6b, #ffa502); padding: 1rem; color: white; border-radius: 10px; }
        .grid { margin-top: 20px; }
        .card { padding: 1rem; border-radius: 10px; background-color: white; box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1); }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <h1>Big Games API Hub</h1>
        <p>Explore collections, clans, and stats from the Big Games universe!</p>
    </header>

<main class="container">
    <h2>Game Collections</h2>
    <ul id="collections-container">Loading...</ul>  <!-- ‚úÖ Data will appear here -->
<section id="live-data">
    <h3>üìä Live Game Data</h3>
    <p>Loading...</p>
</section>



</main>

<script>
// ‚úÖ Fetch and display live game data
async function fetchLiveData() {
    const liveDataContainer = document.getElementById("live-data");
    liveDataContainer.innerHTML = "<p>Loading live data...</p>";

    // ‚úÖ List of APIs to fetch (Live Game Data)
    const endpoints = [
        { name: "‚öîÔ∏è Active Clan Battle", url: "/.netlify/functions/apiFetch?url=https://ps99.biggamesapi.io/api/activeClanBattle" },
        { name: "üèÜ Top Clans (Sorted by Points)", url: "/.netlify/functions/apiFetch?url=https://ps99.biggamesapi.io/api/clans?page=1&pageSize=10&sort=Points&sortOrder=desc" },
        { name: "üëë Example Clan: CAT", url: "/.netlify/functions/apiFetch?url=https://ps99.biggamesapi.io/api/clan/CAT" }
    ];

    try {
        let html = "<h3>üìä Live Game Data</h3>";

        // ‚úÖ Loop through each API and fetch its data
        for (const endpoint of endpoints) {
            const response = await fetch(endpoint.url);
            if (!response.ok) throw new Error(`HTTP Error ${response.status}`);
            const responseData = await response.json();
            console.log(`API Response (${endpoint.name}):`, responseData);

            // ‚úÖ Ensure we correctly access `data`
            if (responseData && responseData.data) {
                html += `<h4>${endpoint.name}</h4>${formatLiveData(responseData.data)}`;
            } else {
                html += `<h4>${endpoint.name}</h4><p>No data available</p>`;
            }
        }

        liveDataContainer.innerHTML = html;
    } catch (error) {
        console.error("Live Data Fetch Error:", error);
        liveDataContainer.innerHTML = "<p class='error'>Failed to load live data.</p>";
    }
}

// ‚úÖ Format JSON object into a clean HTML list
function formatLiveData(data) {
    if (!data || typeof data !== "object") return "<p>No data available</p>";

    let html = "<ul>";

    for (const [key, value] of Object.entries(data)) {
        html += `<li><strong>${formatKey(key)}:</strong> ${value ?? "N/A"}</li>`;
    }

    html += "</ul>";
    return html;
}

// ‚úÖ Properly format key names (e.g., "totalPoints" ‚Üí "Total Points")
function formatKey(key) {
    return key
        .replace(/([A-Z])/g, " $1") // Add space before capital letters
        .replace(/^./, str => str.toUpperCase()) // Capitalize first letter
        .trim();
}

// ‚úÖ Auto-refresh live data every 30 seconds
setInterval(fetchLiveData, 30000);

// ‚úÖ Load data on page load
document.addEventListener("DOMContentLoaded", fetchLiveData);
</script>


</body>
</html>
